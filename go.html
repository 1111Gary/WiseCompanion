<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>跳转中...</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>
        body { background: #0B1120; color: #fff; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; font-family: sans-serif; }
        .btn { padding: 12px 24px; background: #3B82F6; border-radius: 99px; font-weight: bold; margin-top: 20px; text-decoration: none; color: white; display: inline-flex; align-items: center; }
    </style>
</head>
<body>
    <div id="msg" class="text-xl font-bold animate-pulse">正在前往目标页面...</div>
    <div id="manual-box" style="display:none; text-align:center;">
        <p class="text-gray-400 mt-4 text-sm">如果页面没有反应，请点击下方按钮</p>
        <a id="jump-btn" href="#" class="btn" rel="noopener noreferrer">手动前往 <i class="fas fa-arrow-right ml-2"></i></a>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const params = new URLSearchParams(window.location.search);
            const id = params.get('id');
            if(!id) return;

            // 1. 极速获取数据 (优先缓存)
            let act = null;
            const cached = sessionStorage.getItem('data_checkin') || sessionStorage.getItem('data_bank') || sessionStorage.getItem('shopping_data') || sessionStorage.getItem('data_video');
            if(cached) { try { act = JSON.parse(cached).find(a=>a.id===id); } catch(e){} }
            
            if(!act) {
                const res = await fetch('./activities.json');
                const data = await res.json();
                act = data.find(a=>a.id===id);
            }

            if(act) {
                const link = act.link;
                // 设置手动按钮链接（解决自动跳转失败的问题）
                document.getElementById('jump-btn').href = link;
                
                // 2. 尝试自动跳转
                // 使用 replace，不留历史记录
                window.location.replace(link);

                // 3. 如果 500ms 后还没跳走，显示手动按钮
                setTimeout(() => {
                    document.getElementById('msg').innerText = "即将到达";
                    document.getElementById('manual-box').style.display = 'block';
                }, 500);
            } else {
                document.getElementById('msg').innerText = "活动不存在";
            }
        });
    </script>
</body>
</html>
