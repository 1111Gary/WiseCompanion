# .github/workflows/deploy_with_secrets.yml
name: Inject Secrets and Deploy

on:
  push:
    branches:
      - main  # ç¡®ä¿è¿™é‡Œæ˜¯æ‚¨çš„ä¸»åˆ†æ”¯åç§° (main æˆ– master)
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  build-and-deploy:
    permissions:
      contents: read
      pages: write  # å…è®¸å†™å…¥ Pages
      id-token: write # å…è®¸å†™å…¥ ID Token (è§£å†³æ‚¨çœ‹åˆ°çš„é”™è¯¯)
    # ğŸš¨ å¿…é¡»æ·»åŠ è¿™ä¸€å—é…ç½®ï¼
    environment:
      name: github-pages

    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Inject Airtable Secrets into list.js
        # æŸ¥æ‰¾ list.js æ–‡ä»¶ï¼Œå¹¶ç”¨ç¯å¢ƒå˜é‡æ›¿æ¢å ä½ç¬¦
        run: |
          # æ›¿æ¢ PAT
          sed -i "s|<AIRTABLE_PAT>|${{ secrets.AIRTABLE_PAT }}|g" list.js
          # æ›¿æ¢ BASE_ID
          sed -i "s|<AIRTABLE_BASE_ID>|${{ secrets.AIRTABLE_BASE_ID }}|g" list.js
        env:
          AIRTABLE_PAT: ${{ secrets.AIRTABLE_PAT }}
          AIRTABLE_BASE_ID: ${{ secrets.AIRTABLE_BASE_ID }}

      - name: Setup Pages
        uses: actions/configure-pages@v5

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v4
        with:
          path: .

      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
