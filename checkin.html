<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>慧伴管家 - 天天有奖</title>
    <script async defer src="https://umami.example.com/script.js" data-website-id="7b5c80e8-218d-4850-a9f3-d3764a059fed" data-do-not-track="true" data-domains="1111gary.github.io"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="./assets/icon_apple.png">
    <style>
        :root { --color-bg-dark: #0f0f0f; --color-card: #1e1e1e; --color-text-main: #ffffff; --color-primary: #10B981; }
        body { background-color: var(--color-bg-dark); color: var(--color-text-main); padding-bottom: 85px; font-family: sans-serif; padding-top: 100px; }

        #smart-header { position: fixed; top: 0; left: 0; right: 0; z-index: 50; background: rgba(15,15,15,0.95); backdrop-filter: blur(12px); transition: transform 0.3s; border-bottom: 1px solid rgba(255,255,255,0.1); padding-top: env(safe-area-inset-top); }
        .nav-hidden { transform: translateY(-100%); }
        
        .header-row-top { display: flex; align-items: center; justify-content: space-between; height: 48px; padding: 0 16px; }
        .header-row-filter { display: flex; gap: 8px; overflow-x: auto; padding: 0 16px 12px; scrollbar-width: none; }
        
        .chip { display: inline-flex; height: 32px; padding: 0 12px; border-radius: 8px; font-size: 0.85rem; background: #272727; color: #fff; border: 1px solid rgba(255,255,255,0.1); align-items: center; flex-shrink: 0; }
        .chip.active { background: #fff; color: #000; font-weight: 700; }
        
        /* 列表样式 */
        .section-title-card { margin: 1.5rem 1rem 1rem; font-weight: 700; display: flex; align-items: center; gap: 8px; font-size: 1.1rem; }
        
        .task-list-card { background: #1e1e1e; border-radius: 12px; margin: 0 1rem 1rem; border: 1px solid rgba(255,255,255,0.05); overflow: hidden; position: relative; }
        .card-top { display: flex; padding: 16px; align-items: flex-start; }
        
        .task-icon { width: 44px; height: 44px; border-radius: 10px; display: flex; align-items: center; justify-content: center; margin-right: 12px; color: #fff; font-size: 1.3rem; background: #333; flex-shrink: 0; }
        .content-box { flex: 1; min-width: 0; }
        
        /* [核心] 标题行布局：Flex Row */
        .title-row { display: flex; justify-content: space-between; align-items: flex-start; width: 100%; }
        .task-title { font-size: 1rem; font-weight: 600; color: #fff; margin-right: 8px; line-height: 1.3; }
        .special-badge { background: linear-gradient(to right, #F59E0B, #FBBF24); color: #000; font-size: 0.7rem; padding: 2px 6px; border-radius: 4px; font-weight: 700; white-space: nowrap; }

        .badges-container { position: absolute; top: 10px; right: 10px; }
        .badge-timer { background: #EC4899; color: #fff; font-size: 0.7rem; padding: 2px 8px; border-radius: 4px; font-weight: 700; margin-left: auto; display: table; }

        .card-bottom { border-top: 1px solid rgba(255,255,255,0.05); padding: 10px 16px; display: flex; justify-content: space-between; align-items: center; }
        .btn-go { background: #10B981; color: #000; padding: 6px 16px; border-radius: 99px; font-size: 0.8rem; font-weight: 700; }

        .tab-bar { position: fixed; bottom: 0; width: 100%; height: 60px; background: rgba(15,15,15,0.95); backdrop-filter: blur(10px); display: flex; justify-content: space-around; align-items: center; border-top: 1px solid rgba(255,255,255,0.1); z-index: 50; padding-bottom: env(safe-area-inset-bottom); }
        .tab-item.active { color: #10B981; } .tab-item { color: #888; font-size: 0.7rem; display: flex; flex-direction: column; align-items: center; }
    </style>
</head>
<body>
    <header id="smart-header">
        <div class="header-row-top">
            <div style="display:flex;align-items:center;gap:10px;">
                <img src="./assets/icon_apple.png" onerror="this.src='https://placehold.co/32x32/10B981/ffffff?text=C'" style="width:28px;border-radius:6px;">
                <span style="font-weight:700;font-size:1.1rem;">天天有奖</span>
            </div>
            <a href="./index.html" style="color:#888;font-size:1.2rem;"><i class="fas fa-arrow-left"></i></a>
        </div>
        <div class="header-row-filter" id="unified-filter-container">
            <!-- JS -->
        </div>
    </header>

    <main>
        <div class="section-title-card"><i class="fas fa-calendar-check text-green-400"></i> 日常签到</div><div id="daily-checkin-list"></div>
        <div class="section-title-card"><i class="fas fa-stopwatch text-pink-400"></i> 整点抢红包</div><div id="voucher-list"></div>
        <div style="height:40px"></div>
    </main>
    
    <nav class="tab-bar">
        <a href="./index.html" class="tab-item"><i class="fas fa-home text-xl mb-1"></i>首页</a>
        <span class="tab-item active"><i class="fas fa-gifts text-xl mb-1"></i>天天有奖</span>
        <a href="./video.html" class="tab-item"><i class="fas fa-play-circle text-xl mb-1"></i>看视频赚</a>
        <a href="./bank.html" class="tab-item"><i class="fas fa-hand-holding-usd text-xl mb-1"></i>捡钱任务</a>
        <a href="./shopping.html" class="tab-item"><i class="fas fa-tags text-xl mb-1"></i>省钱秘籍</a>
    </nav>

    <script>
        let ALL_ACTIVITIES=[], globalStatus='ongoing';
        const CATEGORY_MAP={'DailyCheckin':{icon:'fa-calendar-check',color:'#10B981'},'Voucher':{icon:'fa-stopwatch',color:'#EC4899'}};
        
        if('scrollRestoration' in history) history.scrollRestoration = 'manual';
        window.addEventListener('beforeunload', () => sessionStorage.setItem('pos_checkin', window.scrollY));
        
        let lastY = 0; const h = document.getElementById('smart-header');
        window.addEventListener('scroll', () => {
            const y = window.scrollY; if(Math.abs(y-lastY)<10)return;
            if(y>lastY && y>60) h.style.transform='translateY(-100%)'; else h.style.transform='translateY(0)';
            lastY = y;
        });

        document.addEventListener('DOMContentLoaded', () => {
            fetch('./activities.json').then(r=>r.json()).then(data => {
                ALL_ACTIVITIES=data.filter(a=>a.category&&(a.category.includes('DailyCheckin')||a.category.includes('Voucher')));
                initFilters(); render(); setInterval(updateTimers, 1000);
                const y = sessionStorage.getItem('pos_checkin'); if(y) setTimeout(()=>window.scrollTo(0,parseInt(y)),50);
            });
        });

        function initFilters() {
            const c = document.getElementById('unified-filter-container');
            const sts = [{v:'ongoing',t:'进行中'},{v:'upcoming',t:'即将开始'},{v:'finished',t:'已结束'}];
            sts.forEach(s => c.innerHTML += `<button class="chip ${globalStatus===s.v?'active':''}" onclick="setStatus('${s.v}')">${s.t}</button>`);
        }
        function setStatus(s) { globalStatus=s; render(); initFilters(); }

        function render() {
            const lists={'DailyCheckin':document.getElementById('daily-checkin-list'),'Voucher':document.getElementById('voucher-list')};
            Object.values(lists).forEach(l=>l.innerHTML='');
            const now = Date.now();
            ALL_ACTIVITIES.filter(act => {
                const e=act.endDate?new Date(act.endDate).getTime():null, s=act.startDate?new Date(act.startDate).getTime():null;
                if(globalStatus==='finished') return e && e<now;
                if(globalStatus==='upcoming') return s && s>now;
                return (!s || s<=now) && (!e || e>=now);
            }).forEach(act => {
                const cat = act.category.find(c => CATEGORY_MAP[c]);
                if(cat && lists[cat]) lists[cat].innerHTML += createCard(act, cat);
            });
            updateTimers();
        }

        function createCard(act, cat) {
            const s = CATEGORY_MAP[cat];
            return `<div class="task-list-card">
                <div class="card-top">
                    <div class="task-icon" style="color:${s.color}"><i class="fas ${s.icon}"></i></div>
                    <div class="content-box">
                        <div class="title-row">
                            <div class="task-title">${act.name}</div>
                            ${act.specialNote ? `<div class="special-badge">${act.specialNote}</div>` : ''}
                        </div>
                        <div style="font-size:0.8rem;color:#aaa;margin-top:4px;">${act.description||''}</div>
                    </div>
                </div>
                <div style="position:relative; margin-top:-35px; margin-bottom:10px; padding-right:16px;">
                    <div class="badge-timer" data-end="${act.endDate}" data-start="${act.startDate}">...</div>
                </div>
                <div class="card-bottom">
                    <div style="color:#888;font-size:0.8rem;"><i class="fas fa-share-alt"></i> 分享</div>
                    <a href="${act.link}" target="_blank" class="btn-go">去领取</a>
                </div>
            </div>`;
        }
        
        function updateTimers() {
            const now = Date.now();
            document.querySelectorAll('.badge-timer').forEach(el => {
                const s=el.dataset.start?new Date(el.dataset.start).getTime():0, e=el.dataset.end?new Date(el.dataset.end).getTime():0;
                if(s>now) el.innerText = `距开始 ${fmt(s-now)}`;
                else if(e>now || !el.dataset.end) el.innerText = (!el.dataset.end) ? '长期' : `剩余 ${fmt(e-now)}`;
                else { el.innerText='已结束'; el.style.background='#333'; }
            });
        }
        function fmt(ms){ const d=Math.floor(ms/86400000), h=Math.floor((ms%86400000)/3600000); return d>0?`${d}天${h}时`:`${h}时`; }
    </script>
</body>
</html>
